{% include "./text-snippets/config_common_steps.md" %}

## App-specific Keys

Follow these steps to configure the **Social Auth** settings and enable user onboarding via Cognito. It requires developers to use the {{config.extra.arcana.dashboard_name}} and the [AWS Management Console](https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-app-idp-settings.html).

### 1. Get Redirect URI  

Select the app in the **Manage Apps** dashboard screen and click Testnet/Mainnet to configure Cognito in the respective configuration profile. Go to **Configure > Social Auth**. Copy the redirect URI shown on the top right.

<figure markdown="span">
  ![Get Redirect URI]({{config.extra.arcana.img_dir}}/an_dApp_config_redirect_uri.{{config.extra.arcana.img_png}}){ .an-screenshots }
  <figcaption>Get Redirect URI</figcaption>
</figure>

Do not close the **Social Auth** browser tab in the {{config.extra.arcana.dashboard_name}}.Open another tab and set up AWS Cognito OAuth. 

### 2. AWS Management Console

Go to the [AWS Management Console](https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-app-idp-settings.html) and register your app as a new Cognito client application. Log in to the console, search for 'Cognito' and you will see the Cognito setup dashboard. Use the Cognito setup dashboard to add the app as a Cognito client in the context of a Cognito 'User Pool'. If a Cognito 'User Pool' is not already set up, create a new User Pool first as highlighted in the figure below. 

!!! an-caution "Cognito Sign-in Options"

      **Email ID** must be selected as one of the Cognito sign-in options. 
      
<figure markdown="span">
  ![AWS Management console]({{config.extra.arcana.img_dir}}/an_dApp_cognito_dev_console.{{config.extra.arcana.img_png}}){ .an-screenshots }
  <figcaption>AWS Management Console</figcaption>
</figure>

If a user pool is already set up, select it from the list and double-click on it to see the details. Refer to the **App Integration** tab settings and click **Create App Client** on the bottom right of the page.

<figure markdown="span">
  ![Create Cognito App Client]({{config.extra.arcana.img_dir}}/an_dApp_cognito_create_app_client.{{config.extra.arcana.img_png}}){ .an-screenshots }
  <figcaption>Create Cognito App Client</figcaption>
</figure>

You will see the **Create Client** dashboard screen. You need to specify the following settings for your app and update the requisite fields in the console:

* App Type: *Public Client*
* App Client Name: *Enter the app name*
* Client Secret: *Select the 'Do not generate client secret' option*
* Authentication Flows: *Select ALLOW_REFRESH_TOKEN_AUTH*

Next, scroll down to the **Hosted UI** section and refer to the **Allowed Callback URLs** field. In this field, add the **Redirect URI** copied from the {{config.extra.arcana.dashboard_name}} in the previous step.

<figure markdown="span">
  ![Update Allowed Callback URLs]({{config.extra.arcana.img_dir}}/an_dApp_cognito_app_client_settings.{{config.extra.arcana.img_png}}){ .an-screenshots }
  <figcaption>Update Allowed Callback URLs</figcaption>
</figure>

Make sure you add *Cognito User Pool* in the **Identity Provider** section of the settings as shown in the figure above. Save the *Cognito User Pool Domain* value as it will be required along with the *Client ID* in the next step.

For the **OAuth 2.0 Grant Type** setting, make sure you specify *Authorization Code Grant* and *Implicit Grant* values as shown in the figure below:

<figure markdown="span">
  ![Cognito OAuth2.0 Grant Type]({{config.extra.arcana.img_dir}}/an_dApp_cognito_app_client_oauth2_grant.{{config.extra.arcana.img_png}}){ .an-screenshots }
  <figcaption>Cognito OAuth2.0 Grant Type</figcaption>
</figure>

In the **Custom Scope** section, ensure that the attribute **EmailID** has read access. This is used by {{config.extra.arcana.sdk_name}} to enable the [aggregate login]({{page.meta.arcana.root_rel_path}}/concepts/aggregatelogin.md) feature.

Save the new client app settings. You will see the new client app entry in the user pool page under the **App Client List** section.

<figure markdown="span">
  ![Cognito Client App List]({{config.extra.arcana.img_dir}}/an_dApp_cognito_app_client_list.{{config.extra.arcana.img_png}}){ .an-screenshots }
  <figcaption>Client App List</figcaption>
</figure>

Copy the **ClientID** that is automatically generated by Cognito for the newly registered Client App. Also save the **Cognito User Pool Domain** value displayed in the dashboard. It will be required in the next step while completing the app configuration using the {{config.extra.arcana.dashboard_name}}.

### 3. Update Social Auth

In the {{config.extra.arcana.dashboard_name}}, click **Configure > Social Auth**. Refer to the empty fields next to the "Cognito" setting. Paste the **Client ID** and the **Cognito User Pool Domain** saved from the AWS Management Console in the previous step.

<figure markdown="span">
  ![Dashboard: Update Cognito ClientID]({{config.extra.arcana.img_dir}}/an_dApp_cognito_config.{{config.extra.arcana.img_png}}){ .an-screenshots }
  <figcaption>Dashboard: Update Cognito ClientID</figcaption>
</figure>

Save the **Social Auth** settings. 

*You are all set with the Cognito configuration.*