{% include "./text-snippets/config_common_steps.md" %}

## App-specific Keys

Follow these steps to configure the **Social Auth** settings and enable user onboarding via Cognito. It requires developers to use the {{config.extra.arcana.dashboard_name}} and the [AWS Management Console](https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-app-idp-settings.html).

### Step 1: Get Redirect URI  

Select the app in the **Manage Apps** dashboard screen and click Testnet/Mainnet to configure Cognito in the respective configuration profile. Go to **Configure > Social Auth**. Copy the redirect URI shown on the top right.

![redirect_page](/img/an_dApp_config_redirect_uri.png){.an-screenshots}

Do not close the **Social Auth** browser tab in the {{config.extra.arcana.dashboard_name}}.Open another tab and set up AWS Cognito OAuth. 

### Step 2: AWS Management Console

Go to the [AWS Management Console](https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pools-app-idp-settings.html) and register your app as a new Cognito client application. Log in to the console, search for 'Cognito' and you will see the Cognito setup dashboard. Use the Cognito setup dashboard to add the app as a Cognito client in the context of a Cognito 'User Pool'. If a Cognito 'User Pool' is not already set up, create a new User Pool first as highlighted in the figure below. 

!!! an-caution "Cognito Sign-in Options"

      **Email ID** must be selected as one of the Cognito sign-in options. 
      
![Cognito console](/img/an_dApp_cognito_dev_console.png){.an-screenshots}

If a user pool is already set up, simply select it from the list and double-click on it to see the details. Refer to the **App Integration** tab settings and click **Create App Client** on the bottom right of the page.

![Cognito create an app client](/img/an_dApp_cognito_create_app_client.png){.an-screenshots}

You will see the **Create Client** dashboard screen. You need to specify the following settings for your app and update the requisite fields in the console:

* App Type: *Public Client*
* App Client Name: *Enter the app name*
* Client Secret: *Select the 'Do not generate client secret' option*
* Authentication Flows: *Select ALLOW_REFRESH_TOKEN_AUTH*

Next, scroll down to the **Hosted UI** section and refer to the **Allowed Callback URLs** field. In this field, add the **Redirect URI** copied from the {{config.extra.arcana.dashboard_name}} in the previous step.

![Cognito Create Client Settings](/img/an_dApp_cognito_app_client_settings.png){.an-screenshots}

Make sure you add *Cognito User Pool* in the **Identity Provider** section of the settings as shown in the figure above. 

For the **OAuth 2.0 Grant Type** setting, make sure you specify *Authorization Code Grant* and *Implicit Grant* values as shown in the figure below:

![Cognito OAuth2.0 Grant Type](/img/an_dApp_cognito_app_client_oauth2_grant.png){.an-screenshots}

In the **Custom Scope** section, ensure that the attribute **EmailID** has read access. This is used by {{config.extra.arcana.sdk_name}} to enable the [aggregate login]({{page.meta.arcana.root_rel_path}}/concepts/authtype/aggregatelogin.md) feature.

Save the new client app settings.  You will see the new client app entry in the user pool page under the **App Client List** section. 

![Cognito Client App List](/img/an_dApp_cognito_app_client_list.png){.an-screenshots}

Copy the **ClientID** that is automatically generated by Cognito for the newly registered Client App. It will be required in the next step while completing the app configuration using the {{config.extra.arcana.dashboard_name}}.

## Step 3: Update Cognito Social Auth Settings

In the {{config.extra.arcana.dashboard_name}}, click **Configure > Social Auth**. Refer to the empty fields next to the "Cognito" setting. Paste the **Client ID** assigned by AWS Management Console after the Cognito OAuth setup in the previous step, in the input text field. 

![howto_config_cognito](/img/an_dApp_cognito_config.png){.an-screenshots}

Save the **Social Auth** settings. 

*You are all set with the Cognito configuration!*